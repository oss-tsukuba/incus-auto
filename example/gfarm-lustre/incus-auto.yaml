config:
  #incus_command: incus  # default
  project: gfarm-lustre
  network:
    gfarm-lustre-net1:
      ipv4.addres: 10.123.123.1/24
      ipv4.dhcp.ranges: 10.123.123.101-10.123.123.200
      ipv4.nat: true
    gfarm-lustre-net2:
      ipv4.addres: 10.210.210.1/24
      ipv4.dhcp: false
      ipv4.nat: false
      ipv6.nat: false
      ipv6.address: none
  profile:
    gfarm-lustre:
      devices:
        root:
          type: disk
          path: /
          pool: mypool
          size: 30GB
    gfarm-lustre-net:
      eth0:
        network: gfarm-lustre-net1
        type: nic
      eth1:
        network: gfarm-lustre-net2
        type: nic

build:
  lustre-server:
    image: images:rockylinux/8
    profile:
      - gfarm-lustre
      - gfarm-lustre-net
    vm: true
    install:
      - install-lustre-server.sh
    publish-remote:
      - incus1
  lustre-client:
    image: images:rockylinux/8
    profile:
      - gfarm-lustre
      - gfarm-lustre-net
    vm: true
    install:
      - install-lustre-client.sh
    publish-remote:
      - incus1
  gfarm:
    image: images:rockylinux/8
    profile:
      - gfarm-lustre
      - gfarm-lustre-net
    vm: false
    install:
      - install-gfarm.sh
    publish-remote:
      - incus1

host:
  mgs:
    image: incus1:lustre-server
    profile:
      - gfarm-lustre
      - gfarm-lustre-net
    #remote: local  # default
    remote: incus1
    vm: true
    disk: 20GB
    networks:
      eth0:
        #ifname: ens5s0  # (default for VM)
        ipv4: 192.168.1.101
    setup:
      - setup-lustre-mgs.sh
    #entrypoint:
    #  - true
  oss0:
    profile: gfarm-lustre
    image: incus1:lustre-server
    vm: true
    disk: 20GB
    networks:
      eth0:
        #ifname: ens5s0 # (default for VM)
        ipv4: 192.168.1.102
    setup:
      - "setup-lustre-oss.sh 0 192.168.1.101"
    #entrypoint:
    #  - true
  lclient1:
    profile: gfarm-lustre
    image: incus1:lustre-client
    vm: true
    disk: 10GB
    networks:
      eth0:
        #ifname: ens5s0 # (default for VM)
        # ipv4: 192.168.1.103  (default: dhcp)
    setup:
      - "setup-lustre-client.sh 0 192.168.1.101"
    #entrypoint:
    #  - true
  gfmd1:
    profile: gfarm-lustre
    image: incus1:gfarm
    vm: false
    disk: 10GB
    networks:
      eth0:
        #ifname: eth0 # (default for container)
        ipv4: 192.168.1.104
    setup:
      - setup-install-gfmd.sh
    #entrypoint:
    #  - entrypoint.sh
  gfsd1:
  gclient1:
  keycloak:

script:
  - test1.sh
  - script1.sh
